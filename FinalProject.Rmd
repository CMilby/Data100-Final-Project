---
title: "Data 100 - Final Project"
output: html_notebook
runtime: shiny
---

```{r echo=FALSE}
install.packages( "maps" )

require(ggplot2)
require(maps)
```


```{r echo=FALSE }
data_2011 <- read.csv ( "2011.csv", header = TRUE, na.strings = c ( "", "NA" ) )
data_2012 <- read.csv ( "2012.csv", header = TRUE, na.strings = c ( "", "NA" ) )
data_2013 <- read.csv ( "2013.csv", header = TRUE, na.strings = c ( "", "NA" ) )
data_2014 <- read.csv ( "2014.csv", header = TRUE, na.strings = c ( "", "NA" ) )
data_2015 <- read.csv ( "2015.csv", header = TRUE, na.strings = c ( "", "NA" ) )
data_2016 <- read.csv ( "2016.csv", header = TRUE, na.strings = c ( "", "NA" ) )
data_2017 <- read.csv ( "2017.csv", header = TRUE, na.strings = c ( "", "NA" ) )
```


```{r echo=FALSE}
language_use2011 <- c ( NROW ( data_2011 [ !is.na ( data_2011$Which.languages.are.you.proficient.in. ), ] ), # Java
                        NROW ( data_2011 [ !is.na ( data_2011$X.18 ), ] ), # JavaScript
                        NROW ( data_2011 [ !is.na ( data_2011$X.20 ), ] ), # PHP
                        NROW ( data_2011 [ !is.na ( data_2011$X.21 ), ] ), # Python
                        NROW ( data_2011 [ !is.na ( data_2011$X.22 ), ] ), # Ruby
                        NROW ( data_2011 [ !is.na ( data_2011$X.23 ), ] ), # SQL
                        NROW ( data_2011 [ !is.na ( data_2011$X.24 ), ] ), # C#
                        NROW ( data_2011 [ !is.na ( data_2011$X.25 ), ] ), # C++
                        NROW ( data_2011 [ !is.na ( data_2011$X.26 ), ] ), # C
                        0, # Objective-C
                        0 ) # Node-JS

language_use2012 <- c ( NROW ( data_2012 [ !is.na ( data_2012$Which.languages.are.you.proficient.in. ), ] ), # Java
                        NROW ( data_2012 [ !is.na ( data_2012$X.11 ), ] ), # JavaScript
                        NROW ( data_2012 [ !is.na ( data_2012$X.13 ), ] ), # PHP
                        NROW ( data_2012 [ !is.na ( data_2012$X.14 ), ] ), # Python
                        NROW ( data_2012 [ !is.na ( data_2012$X.16 ), ] ), # Ruby
                        NROW ( data_2012 [ !is.na ( data_2012$X.17 ), ] ), # SQL
                        NROW ( data_2012 [ !is.na ( data_2012$X.18 ), ] ), # C#
                        NROW ( data_2012 [ !is.na ( data_2012$X.19 ), ] ), # C++
                        NROW ( data_2012 [ !is.na ( data_2012$X.20 ), ] ), # C
                        NROW ( data_2012 [ !is.na ( data_2012$X.15 ), ] ), # Objective-C
                        0 ) # Node-JS
                        
language_use2013 <- c ( NROW ( data_2013 [ !is.na ( data_2013$X.42 ), ] ), # Java
                        NROW ( data_2013 [ !is.na ( data_2013$X.43 ), ] ), # JavaScript
                        NROW ( data_2013 [ !is.na ( data_2013$X.48 ), ] ), # PHP
                        NROW ( data_2013 [ !is.na ( data_2013$X.49 ), ] ), # Python
                        NROW ( data_2013 [ !is.na ( data_2013$X.50 ), ] ), # Ruby
                        NROW ( data_2013 [ !is.na ( data_2013$X.51 ), ] ), # SQL
                        NROW ( data_2013 [ !is.na ( data_2013$X.41 ), ] ), # C#
                        NROW ( data_2013 [ !is.na ( data_2013$X.40 ), ] ), # C++
                        NROW ( data_2013 [ !is.na ( data_2013$Which.of.the.following.languages.or.technologies.have.you.used.significantly.in.the.past.year. ), ] ), # C
                        NROW ( data_2013 [ !is.na ( data_2013$X.47 ), ] ), # Objective-C
                        NROW ( data_2013 [ !is.na ( data_2013$X.46 ), ] ) ) # Node-JS
                
language_use2014 <- c ( NROW ( data_2014 [ !is.na ( data_2014$X.27 ), ] ), # Java
                        NROW ( data_2014 [ !is.na ( data_2014$X.28 ), ] ), # JavaScript
                        NROW ( data_2014 [ !is.na ( data_2014$X.31 ), ] ), # PHP
                        NROW ( data_2014 [ !is.na ( data_2014$X.32 ), ] ), # Python
                        NROW ( data_2014 [ !is.na ( data_2014$X.33 ), ] ), # Ruby
                        NROW ( data_2014 [ !is.na ( data_2014$X.34 ), ] ), # SQL
                        NROW ( data_2014 [ !is.na ( data_2014$X.26 ), ] ), # C#
                        NROW ( data_2014 [ !is.na ( data_2014$X.25 ), ] ), # C++
                        NROW ( data_2014 [ !is.na ( data_2014$X.24 ), ] ), # C
                        NROW ( data_2014 [ !is.na ( data_2014$X.30 ), ] ), # Objective-C
                        NROW ( data_2014 [ !is.na ( data_2014$X.29 ), ] ) ) # Node-Js

language_use2015 <- c ( NROW ( data_2015 [ !is.na ( data_2015$Current.Lang...Tech..Java ), ] ), # Java
                        NROW ( data_2015 [ !is.na ( data_2015$Current.Lang...Tech..JavaScript ), ] ), # JavaScript
                        NROW ( data_2015 [ !is.na ( data_2015$Current.Lang...Tech..PHP ), ] ), # PHP
                        NROW ( data_2015 [ !is.na ( data_2015$Current.Lang...Tech..Python ), ] ), # Python
                        NROW ( data_2015 [ !is.na ( data_2015$Current.Lang...Tech..Ruby ), ] ), # Ruby
                        NROW ( data_2015 [ !is.na ( data_2015$Current.Lang...Tech..SQL ), ] ), # SQL
                        NROW ( data_2015 [ !is.na ( data_2015$Current.Lang...Tech..C. ), ] ), # C#
                        NROW ( data_2015 [ !is.na ( data_2015$Current.Lang...Tech..C.. ), ] ), # C++
                        NROW ( data_2015 [ !is.na ( data_2015$Current.Lang...Tech..C ), ] ), # C
                        NROW ( data_2015 [ !is.na ( data_2015$Current.Lang...Tech..Objective.C ), ] ), # OBjective-C
                        NROW ( data_2015 [ !is.na ( data_2015$Current.Lang...Tech..Node.js ), ] ) ) # Node-JS
  
langs <- c ( "Java", "JavaScript", "PHP", "Python", "Ruby", "SQL", "C#", "C++", "C", "Objective-C", "Node.js")
language_use2016 <- data.frame ( langs, rep.int ( 0, 11 ), rep ( 2016, 11 ) )  
rownames ( language_use2016 ) <- c ( "Java", "JavaScript", "PHP", "Python", "Ruby", "SQL", "C#", "C++", "C", "Objective-C", "Node.js")

for ( i in data_2016$tech_do ) {
  if ( !is.na ( i ) ) {
    vals <- strsplit ( toString ( i ), "; " )
    vals <- unlist ( vals )
    for ( j in vals ) {
      if ( !is.na ( j ) ) {
        if ( toString ( j ) %in% rownames ( language_use2016 ) ) {
          language_use2016 [ j, 2 ] <- language_use2016 [ j, 2 ] + 1 
        }
      }
    }
  } 
}

language_use2016$rep.int.0..11. <- language_use2016 [ , 2 ] / NROW ( data_2016 )

language_use2017 <- data.frame ( langs, rep.int ( 0, 11 ), rep ( 2017, 11 ) )
rownames ( language_use2017 ) <- c ( "Java", "JavaScript", "PHP", "Python", "Ruby", "SQL", "C#", "C++", "C", "Objective-C", "Node.js")

for ( i in data_2017$HaveWorkedLanguage ) {
  if ( !is.na ( i ) ) {
    vals <- strsplit ( toString ( i ), "; " )
    vals <- unlist ( vals )
    for ( j in vals ) {
      if ( !is.na ( j ) ) {
        if ( toString ( j ) %in% rownames ( language_use2017 ) ) {
          language_use2017 [ j, 2 ] <- language_use2017 [ j, 2 ] + 1 
        }
      }
    }
  } 
}

language_use2017$rep.int.0..11. <- language_use2017 [ , 2 ] / NROW ( data_2017 )

rm ( i, j, vals )

language_use2011 <- data.frame ( langs, language_use2011 / NROW ( data_2011 ), rep ( 2011, 11 ) )
language_use2012 <- data.frame ( langs, language_use2012 / NROW ( data_2012 ), rep ( 2012, 11 ) )
language_use2013 <- data.frame ( langs, language_use2013 / NROW ( data_2013 ), rep ( 2013, 11 ) )
language_use2014 <- data.frame ( langs, language_use2014 / NROW ( data_2014 ), rep ( 2014, 11 ) )
language_use2015 <- data.frame ( langs, language_use2015 / NROW ( data_2015 ), rep ( 2015, 11 ) )

names <- c ( "Language", "Percent", "Year" )
colnames( language_use2011 ) <- names
colnames( language_use2012 ) <- names
colnames( language_use2013 ) <- names
colnames( language_use2014 ) <- names
colnames( language_use2015 ) <- names
colnames( language_use2016 ) <- names
colnames( language_use2017 ) <- names

rm ( langs, names )

language_use <- list ( language_use2011, language_use2012, language_use2013, language_use2014, language_use2015, language_use2016, language_use2017 )
language_use <- do.call ( rbind, language_use )

rm ( language_use2011, language_use2012, language_use2013, language_use2014, language_use2015, language_use2016, language_use2017 )

# ggplot ( data = language_use, aes ( x = Year, y = Percent,group = Language  ) ) +
#   geom_point ( aes ( color = Language ) ) +
#   geom_line ( aes ( color = Language ) )
```

```{r echo=FALSE}
renderPlot ( {
  ggplot ( data = language_use, aes ( x = Year, y = Percent,group = Language  ) ) +
    geom_point ( aes ( color = Language ) ) +
    geom_line ( aes ( color = Language ) )
} )
```

```{r echo=FALSE}
gender_2017 <- data.frame ( data_2017 [ ( ( data_2017$Gender == "Female" | data_2017$Gender == "Male" ) & !is.na ( data_2017$Gender ) ), "Gender" ] )
gender_2017 <- data.frame ( gender_2017, rep ( 2017, NROW ( gender_2017 ) ) )
num_not_null <- NROW ( data_2017 [ !is.na ( data_2017$Gender ), ] )

other <- data.frame ( rep ( "Other", num_not_null - NROW ( gender_2017 ) ), rep ( 2017, num_not_null - NROW ( gender_2017 ) ) )
colnames ( other ) <- c ( "Gender", "Year" )
colnames( gender_2017 ) <- c ( "Gender", "Year" )
gender_2017 <- rbind ( gender_2017, other )

gender_2015 <- data.frame ( data_2015$Gender, rep ( 2015, NROW ( data_2015 ) ) )
gender_2016 <- data.frame ( data_2016$gender, rep ( 2016, NROW ( data_2016 ) ) )
colnames ( gender_2015 ) <- c ( "Gender", "Year" )
colnames ( gender_2016 ) <- c ( "Gender", "Year" )

gender <- list ( gender_2015, gender_2016, gender_2017 )
gender <- do.call ( rbind, gender )

gender <- table( gender )
gender <- data.frame ( gender )
gender <- gender [ gender$Freq != 0 & gender$Gender != "Prefer not to disclose", ]

ggplot ( data = gender, aes( Year, Freq ) ) +
  geom_bar( aes ( fill = Gender ), position = "dodge", stat = "identity" )

rm ( num_not_null, other, gender_2015, gender_2016, gender_2017 )
```

```{r echo=FALSE}
country <- data_2017$Country
country <- data.frame ( table ( country ) )
country$country <- as.character( country$country )
country$country [ country$country == "United States" ] <- "USA"
country$country [ country$country == "United Kingdom" ] <- "UK"
country$country [ country$country == "Russian Federation" ] <- "Russia"
country <- country [ - c ( 9 ), ] # Remove Antartica
colnames ( country ) <- c ( "region", "freq" )

map.world <- map_data ( "world" )
map.world <- merge( x = map.world, y = country, by = "region", all = TRUE)
map.world <- map.world [ order ( map.world$order ), ]

ggplot ( ) + 
  theme ( legend.position = "none" ) +
  geom_map( data = map.world, map = map.world, aes ( map_id = region, x = long, y = lat, fill = freq ) ) +
  scale_fill_gradient( low = "green", high = "blue", guide = "colourbar" ) +
  coord_equal ( )

rm ( country )
```


```{r echo=FALSE}
satisfaction_company_2017 <- subset(data_2017, select = c("CompanyType", "JobSatisfaction"))
satisfaction_company_2017 <- subset(satisfaction_company_2017, !(is.na(satisfaction_company_2017$CompanyType)) & !(is.na(satisfaction_company_2017$JobSatisfaction)))
satisfaction_company_2017
```
```{r echo=FALSE}
satisfaction_avg_2017 <- aggregate(satisfaction_company_2017$JobSatisfaction, by=list(CompanyType=satisfaction_company_2017$CompanyType), FUN = mean)
satisfaction_avg_2017

```


```{r echo=FALSE}

renderPlot ( {
  ggplot(data = satisfaction_avg_2017, aes (x = CompanyType, y = x)) + geom_bar(stat = "identity", aes (fill = CompanyType), show.legend = FALSE) + coord_flip() + labs(title = "Job Satisfaction per Company Type (2017)", y = "Average Job Satisfaction: ( 0 - 10 )", x = "Company Type")
})

```


